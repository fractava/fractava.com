FROM nginx:alpine

ARG branch

RUN apk add bash npm git

RUN mkdir -p /config-buildtime/log/

# copy everything
COPY ./ .gitignore .gitlab-ci.yml /config-buildtime/
COPY .git/ /config-buildtime/.git/

# remove default nginx config
RUN rm -R /etc/nginx/*

# copy start script
COPY start.sh start.dev.sh /

# make start script executable
RUN chmod +x /start.sh
RUN chmod +x /start.dev.sh

EXPOSE 80

ENTRYPOINT ["sh","/start.dev.sh"]
